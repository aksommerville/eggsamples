<!DOCTYPE html>
<html><head><link rel="icon" type="image/png" href="data:;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEUAAAD///8AAADlCwsT1GUDAAAAAXRSTlMAQObYZgAAAEZJREFUeNpjZGAIYGBgYFz6hYGBbfpfJoYQIIdxCYM/I5sXUJzNgYGBCUgDCVEgk3HVBCA7NAUkkgKVEA0FklkgCdFQBwYAxYkK1S+l8aUAAAAASUVORK5CYII=" />
<title>Snake</title>
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1,user-scalable=no" /><style>html{background-color:#000;color:#fff;}body{margin:0;overflow:hidden;}egg-rom{display:none;}#fbouter{width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background-color:#000;position:relative;}canvas#eggfb{image-rendering:pixelated;cursor:none;}#umenu{position:absolute;left:0;top:0;width:100%;height:100%;background-color:#000e;cursor:normal;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:36pt;}#umenu .row{display:flex;flex-direction:row;align-items:center;justify-content:space-between;width:50%;z-index:1;}#umenu .keyIcon{width:120px;}#umenu input[type='range']{flex:1;}#umenu input[type='button']{font-size:36pt;}#incfg{position:absolute;left:0;top:0;width:100%;height:100%;background-color:#000;z-index:2;image-rendering:pixelated;}#touch{position:fixed;left:0;top:0;width:100%;height:100%;z-index:100;}</style><script>const[k5,k6,k7,k8,k9,la,lb,lc,ld,le,lf,lg,lh,li,lj,lk,ll,lm,ln,lo,lp,lq,lr,ls,lt,lu,lv,lw,lx,ly,lz,lA,lB,lC,lD,lE,lF,lG,lH,lI,lJ,lK,lL,lM,lN,lO,lP,lQ,lR,lS,lT,lU,lV,lW,lX,lY,lZ,l_,l$,l0,l1,l2,l3,l4,l5,l6,l7,l8,l9,ma,mb,mc,md,me,mf,mg,mh,mi,mj,mk,ml,mm,mn,mo,mp,mq,mr,ms,mt,mu,mv,mw,mx,my,mz,mA,mB,mC,mD,mE,mF,mG,mH,mI,mJ,mK,mL,mM,mN,mO,mP,mQ,mR,mS,mT,mU,mV,mW,mX,mY,mZ,m_,m$,m0,m1,m2,m3,m4,m5,m6,m7,m8,m9,na,nb,nc,nd,ne,nf,ng,nh,ni,nj,nk,nl,nm,nn,no,np,nq,nr,ns,nt,nu,nv,nw,nx,ny,nz,nA,nB,nC,nD,nE,nF,nG,nH,nI,nJ,nK,nL,nM,nN,nO,nP,nQ,nR,nS,nT,nU,nV,nW,nX,nY,nZ,n_,n$,n0,n1,n2,n3,n4,n5,n6,n7,n8,n9,pa,pb,pc,pd,pe,pf,pg,ph,pi,pj,pk,pl,pm,pn,po,pp,pq,pr,ps,pt,pu,pv,pw,px,py,pz,pA,pB,pC,pD,pE,pF,pG,pH,pI,pJ,pK,pL,pM,pN,pO,pP,pQ,pR,pS,pT,pU,pV,pW,pX,pY,pZ,p_,p$,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9,qa,qb]="RGBA,axes,body,chid,code,done,exec,fbid,fill,find,glsl,keys,lang,left,meta,mode,move,name,node,path,port,push,rect,resv,size,stop,texv,then,trim,type,vbuf,BLEND,SHORT,audio,btnid,catch,clear,devid,error,floor,fntab,focus,incfg,index,input,parse,rawCb,ready,round,slice,spawn,split,start,state,style,title,touch,u_tex,umenu,utint,value,video,width,LINEAR,border,buffer,canvas,cookie,decode,enable,filter,framec,getRes,height,images,joyMap,keyMap,length,lineTo,memory,mousex,mousey,moveTo,onLang,pvmode,reject,remove,repeat,resume,serial,splice,statev,stroke,target,ualpha,update,NEAREST,advance,buttonp,buttons,ellipse,exports,fbready,gamepad,getItem,getMeta,gltexid,indexOf,message,onEvent,onMusic,onSound,onTouch,options,pgm_raw,pgm_tex,playerc,pvinput,setItem,suspend,timeout,vbufs16,TEXTURE0,dsttexid,duration,fillText,gamepads,getMem32,includes,instance,langEval,onResize,pgm_tile,playerid,srctexid,startNow,toString,usampler,usrcsize,viewport,beginPath,fillStyle,findIndex,getMemory,getString,musicTrim,pgm_fancy,renderNow,setString,soundTrim,startTime,stringify,substring,textAlign,uniform1f,uniform1i,uniform2f,uniform4f,TEXTURE_2D,autoAssign,bindBuffer,bufferData,byteLength,byteOffset,charCodeAt,clearColor,clientInit,drawArrays,exitStatus,getContext,initStatus,removeItem,startsWith,terminated,texImage2D,udstborder,useProgram,usrcborder,FRAMEBUFFER,STREAM_DRAW,appendChild,arrayBuffer,assignments,bindTexture,currentTime,destination,initPromise,keyListener,postMessage,storePrefix,strokeStyle,tex_current,textDecoder,textEncoder,uscreensize,ARRAY_BUFFER,audioWorklet,channelCount,devidDisplay,fromCharCode,naturalWidth,pendingFrame,textBaseline,CLAMP_TO_EDGE,UNSIGNED_BYTE,VERTEX_SHADER,activeElement,activeTexture,compileShader,createElement,defaultJoyMap,egg_play_song,egg_prefs_set,egg_terminate,focusListener,maxUpdateTime,minUpdateTime,mouseListener,naturalHeight,querySelector,renderTimeout,selectedIndex,songsBySongid,texParameteri,zeroAllStates,TRIANGLE_STRIP,compileShader1,dispatchAction,durationsByRid,getElementById,lastUpdateTime,menuEnablement,nextWaveCookie,preventDefault,requireTexture,resizeObserver,bindFramebuffer,createObjectURL,egg_client_quit,gamepadListener,revokeObjectURL,stopPropagation,COLOR_BUFFER_BIT,addEventListener,setGamepadButton,defaultUpdateTime,deleteFramebuffer,dropMouseListener,egg_client_notify,pendingWavePrints,TEXTURE_MAG_FILTER,TEXTURE_MIN_FILTER,egg_input_set_mode,requireFramebuffer,egg_input_configure,removeEventListener,vertexAttribPointer,egg_texture_load_raw,requireMouseListener,calculateSongDuration,getBoundingClientRect,enableVertexAttribArray,disableVertexAttribArray".split(',');const f=1,g=2,j=3,o=4,t=5,z=6,A=7,B=8,C=9,D=10;class E{constructor(F){this[mu]=F;if(!(F instanceof Uint8Array))throw new Error("Expected Uint8Array");this[ls]=[];if(F[mi]<4||F[0]!==0||F[1]!==69||F[2]!==82||F[3]!==77){throw new Error("Invalid ROM")}let G=4,H=1,I=1;for(;;){const J=F[G++];if(!J)break;switch(J&192){case 0:{H+=J;I=1}break;case 64:I+=((J&63)<<8|F[G++])+1;break;case 128:{let K=(J&63)<<16;K|=F[G++]<<8;K|=F[G++];K++;if(H>255||I>65535||G>F[mi]-K){throw new Error("Invalid ROM")}this[ls][lq]({tid:H,rid:I,v:new Uint8Array(F[l6],F[nE]+G,K)});I++;G+=K}break;default:throw new Error("Invalid ROM");}}this.td=new TextDecoder("utf8");this[lj]={};F=this[md](f,1);if(F&&F[mi]>=4&&F[0]===0&&F[1]===69&&F[2]===77&&F[3]===68){for(G=4;;){const L=F[G++];if(!L)break;const M=F[G++];if(G>F[mi]-M-L)break;const N=this.td[l9](new Uint8Array(F[l6],F[nE]+G,L));G+=L;const O=this.td[l9](new Uint8Array(F[l6],F[nE]+G,M));G+=M;this[lj][N]=O}}}getRes(P,Q){let R=0,S=this[ls][mi];while(R<S){const T=R+S>>1;const U=this[ls][T];if(P<U.tid)S=T;else if(P>U.tid)R=T+1;else if(Q<U.rid)S=T;else if(Q>U.rid)R=T+1;else return U.v}return null}getMeta(V,W){if(W){const X=+this[lj][(V+"$")];if(X){const Y=this[nl](W,1,X);if(Y)return Y}}return this[lj][V]||""}getString(Z,_,$){return this.readString(this[md](j,Z<<6|_),$)}readString(aa,ab){if(ab<1)return"";if(!aa||aa[mi]<4||aa[0]!==0||aa[1]!==69||aa[2]!==83||aa[3]!==84)return"";let ac=4;for(;;){const ad=aa[ac]<<8|aa[(ac+1)];ac+=2;if(ac>aa[mi]-ad)return"";if(!--ab)return this.td[l9](new Uint8Array(aa[l6],aa[nE]+ac,ad));ac+=ad}}}class ae{constructor(af){this.rt=af;this[lJ]=[];this[n5]=new TextDecoder("utf8");this[n6]=new TextEncoder("utf8")}load(ag){this[mk]=new WebAssembly.Memory({initial:300,maximum:2000});const ah={env:{memory:this[mk],egg_terminate:ai=>this.rt[pq](ai),egg_log:msgp=>this.rt.egg_log(msgp),egg_time_real:()=>this.rt.egg_time_real(),egg_time_local:(aj,ak)=>this.rt.egg_time_local(aj,ak),egg_prefs_get:k=>this.rt.egg_prefs_get(k),egg_prefs_set:(al,am)=>this.rt[pp](al,am),egg_rom_get:(an,ao)=>this.rt.egg_rom_get(an,ao),egg_rom_get_res:(ap,aq,ar,as)=>this.rt.egg_rom_get_res(ap,aq,ar,as),egg_store_get:(at,au,av,aw)=>this.rt.egg_store_get(at,au,av,aw),egg_store_set:(ax,ay,az,aA)=>this.rt.egg_store_set(ax,ay,az,aA),egg_store_key_by_index:(aB,aC,aD)=>this.rt.egg_store_key_by_index(aB,aC,aD),egg_input_configure:()=>this.rt[lN][p3](),egg_input_get_all:(aE,aF)=>this.rt[lN].egg_input_get_all(aE,aF),egg_input_get_one:playerid=>this.rt[lN].egg_input_get_one(playerid),egg_input_set_mode:m=>this.rt[lN][p1](m),egg_input_get_mouse:(aG,aH)=>this.rt[lN].egg_input_get_mouse(aG,aH),egg_play_sound:(aI,aJ,aK)=>this.rt[lC].egg_play_sound(aI,aJ,aK),egg_play_song:(aL,aM,aN,aO,aP)=>this.rt[lC][po](aL,aM,aN,aO,aP),egg_song_set:(aQ,aR,aS,aT)=>this.rt[lC].egg_song_set(aQ,aR,aS,aT),egg_song_event_note_on:(aU,aV,aW,aX)=>this.rt[lC].egg_song_event_note_on(aU,aV,aW,aX),egg_song_event_note_off:(aY,aZ,a_)=>this.rt[lC].egg_song_event_note_off(aY,aZ,a_),egg_song_event_note_once:(a$,a0,a1,a2,a3)=>this.rt[lC].egg_song_event_note_once(a$,a0,a1,a2,a3),egg_song_event_wheel:(a4,a5,a6)=>this.rt[lC].egg_song_event_wheel(a4,a5,a6),egg_song_get_playhead:a7=>this.rt[lC].egg_song_get_playhead(a7),egg_texture_del:texid=>this.rt[l2].egg_texture_del(texid),egg_texture_new:()=>this.rt[l2].egg_texture_new(),egg_texture_get_size:(a8,a9,ba)=>this.rt[l2].egg_texture_get_size(a8,a9,ba),egg_texture_load_image:(bb,bc)=>this.rt[l2].egg_texture_load_image(bb,bc),egg_texture_load_raw:(bd,be,bf,bg,bh,bi)=>this.rt[l2][p6](bd,be,bf,bg,bh,bi),egg_texture_get_pixels:(bj,bk,bl)=>this.rt[l2].egg_texture_get_pixels(bj,bk,bl),egg_texture_clear:texid=>this.rt[l2].egg_texture_clear(texid),egg_render:(bm,bn,bo)=>this.rt[l2].egg_render(bm,bn,bo)}};return WebAssembly.instantiate(ag,ah)[lw](result=>{const bp=name=>{if(!result[m6][mG][name]){throw new Error("ROM does not export required symbol '"+name+"'")}this[name]=result[m6][mG][name]};bp("egg_client_quit");bp("egg_client_init");bp("egg_client_notify");bp("egg_client_update");bp("egg_client_render");this[lJ]=result[m6][mG].__indirect_function_table})}getMem8(){return new Uint8Array(this[mk][l6])}getMem32(){return new Uint32Array(this[mk][l6])}getMemf64(){return new Float64Array(this[mk][l6])}getMemory(bq,br){if(bq<0)return null;if(bq>this[mk][l6][nD])return null;if(br<0)br=this[mk][l6][nD]-bq;if(bq>this[mk][l6][nD]-br)return null;return new Uint8Array(this[mk][l6],bq,br)}getString(bs,bt){if(bs<0)return"";const bu=new Uint8Array(this[mk][l6]);let bv=0;if(typeof bt==="number"){while(bv<bt&&bu[(bs+bv)])bv++}else{while(bu[(bs+bv)])bv++}try{return this[n5][l9](this[nk](bs,bv))}catch(e){return""}}setString(bw,bx,by){by=this[n6].encode(by);if(bx<0)return by[mi];const bz=this[nk](bw,bx);if(by[mi]>bz[mi])return by[mi];bz.set(by);return by[mi]}}const bA=4096;class bB{constructor(bC){this.rt=bC;this[lv]=[];this[l7]=null;this.gl=null;this[l6]=null;this[lz]=new Uint8Array(48)[l6];this[m_]=new Uint16Array(this[lz]);this[n4]=null;this[pM]=new ResizeObserver(e=>this[m8](e));const[bD,bE]=(this.rt.rom[mK]("fb")||"640x360")[lU]("x").map(v=>+v);if(isNaN(bD)||bD<1||bD>bA||isNaN(bE)||bE<1||bE>bA){throw new Error("Invalid framebuffer size.")}this.fbw=bD;this.fbh=bE}start(){this[lv]=[];this[pM].observe(document[pG]("fbouter"));this[l7]=document[pG]("eggfb");if(this[l7]?.tagName!=="CANVAS")throw new Error("Canvas not found.");this[l7][pU]("contextmenu",e=>{e[pK]();e[pS]()});this[l7][l3]=this.fbw;this[l7][me]=this.fbh;this[m8](null);this.gl=this[l7][nK]("webgl");this[lv][1]={gltexid:0,border:0,w:this.fbw,h:this.fbh,fbid:0};this[p6](1,this.fbw,this.fbh,0,null);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.gl[ma](this.gl[lA]);if(!(this[l6]=this.gl.createBuffer()))throw new Error("Failed to create WebGL vertex buffer.");this.compileShaders()}stop(){this.gl[pN](this.gl[nT],null);this.gl[ng](0,0,this[l7][l3],this[l7][me]);this.gl[nG](0,0,0,1);this.gl[lF](this.gl[pT])}onResize(bF){const bG=document[pG]("fbouter");if(!bG||!this[l7])return;const bH=bG[p9]();const bI=this[l7][l3];const bJ=this[l7][me];const bK=Math[lI](bH[l3]/bI);const bL=Math[lI](bH[me]/bJ);const bM=Math.max(1,Math.min(bK,bL));this[l7][lX][l3]=bI*bM+"px";this[l7][lX][me]=bJ*bM+"px"}beginFrame(){this[n4]=null}endFrame(){const bN=this[lv][1];if(!bN)return;const bO=this[l7][l3],bP=this[l7][me];const bQ=this[m_];bQ[0]=0;bQ[1]=0;bQ[2]=0;bQ[3]=bN.h;bQ[6]=0;bQ[7]=bP;bQ[8]=0;bQ[9]=0;bQ[12]=bO;bQ[13]=0;bQ[14]=bN.w;bQ[15]=bN.h;bQ[18]=bO;bQ[19]=bP;bQ[20]=bN.w;bQ[21]=0;this.gl[nB](this.gl[n8],this[l6]);this.gl[nC](this.gl[n8],this[lz],this.gl[nU]);this.gl[pN](this.gl[nT],null);this.gl[ng](0,0,bO,bP);this.gl[nR](this[mU]);this.gl[nx](this[l_][n7],bO,bP);this.gl[nx](this[l_][nf],bO,bP);this.gl[nv](this[l_][nQ],0);this.gl[nv](this[l_][nS],bN[l5]);this.gl[nw](this[l_][ne],0);this.gl[pk](this.gl[m$]);this.gl[nY](this.gl[nz],bN[mL]);this.gl[ny](this[l_][l0],0,0,0,0);this.gl[nv](this[l_][mz],1);this.gl.disable(this.gl[lA]);this.gl[qa](0);this.gl[qa](1);this.gl[p5](0,2,this.gl[lB],!1,12,0);this.gl[p5](1,2,this.gl[lB],!1,12,4);this.gl[nI](this.gl[pC],0,4);this.gl[qb](0);this.gl[qb](1);this.gl[ma](this.gl[lA])}compileShaders(){this[mT]=this[pl]("raw",["apos","acolor"],["uscreensize","udstborder","utint","ualpha"]);this[mU]=this[pl]("tex",["apos","atexcoord"],["uscreensize","usrcsize","udstborder","usrcborder","utint","ualpha","usampler"]);this[m9]=this[pl]("tile",["apos","atileid","axform"],["uscreensize","usrcsize","udstborder","usrcborder","utint","ualpha","usampler"]);this[nn]=this[pl]("fancy",["apos","atileid","axform","arotation","asize","atint","aprimary"],["uscreensize","usrcsize","udstborder","usrcborder","utint","ualpha","usampler"])}compileShader(bR,bS,bT){const bU=this.gl.createProgram();if(!bU)throw new Error("Failed to create new WebGL program for "+JSON[ns](bR));try{this[pD](bR,bU,this.gl[pi],bB[lf][(bR+"_v")]);this[pD](bR,bU,this.gl.FRAGMENT_SHADER,bB[lf][(bR+"_f")]);for(let bV=0;bV<bS[mi];bV++)this.gl.bindAttribLocation(bU,bV,bS[bV]);this.gl.linkProgram(bU);if(!this.gl.getProgramParameter(bU,this.gl.LINK_STATUS)){const bW=this.gl.getProgramInfoLog(bU);throw new Error("Failed to link program "+JSON[ns](bR)+":\n"+bW)}this.gl[nR](bU);const udst=this[("u_"+bR)]={};for(const uName of bT)udst[uName]=this.gl.getUniformLocation(bU,uName)}catch(e){this.gl.deleteProgram(bU);throw e}return bU}compileShader1(bX,bY,bZ,b_){const b$=this.gl.createShader(bZ);if(!b$)throw new Error("Failed to create new WebGL shader for "+JSON[ns](bX));try{this.gl.shaderSource(b$,b_);this.gl[pl](b$);if(!this.gl.getShaderParameter(b$,this.gl.COMPILE_STATUS)){const b0=this.gl.getShaderInfoLog(b$);throw new Error("Failed to link "+(bZ===this.gl[pi]?"vertex":"fragment")+" shader for "+JSON[ns](bX)+":\n"+b0)}this.gl.attachShader(bY,b$)}finally{this.gl.deleteShader(b$)}}requireTexture(b1){if(b1[mL])return 1;if(!(b1[mL]=this.gl.createTexture()))return 0;this.gl[nY](this.gl[nz],b1[mL]);this.gl[pA](this.gl[nz],this.gl.TEXTURE_WRAP_S,this.gl[pg]);this.gl[pA](this.gl[nz],this.gl.TEXTURE_WRAP_T,this.gl[pg]);this.gl[pA](this.gl[nz],this.gl[p0],this.gl[l4]);this.gl[pA](this.gl[nz],this.gl[p$],this.gl[mB]);return 1}requireFramebuffer(b2){if(b2[mH])return 1;this[pL](b2);if(!b2[lc]){if(!(b2[lc]=this.gl.createFramebuffer()))return 0}this.gl[pN](this.gl[nT],b2[lc]);this.gl.framebufferTexture2D(this.gl[nT],this.gl.COLOR_ATTACHMENT0,this.gl[nz],b2[mL],0);const b3=this.gl.checkFramebufferStatus(this.gl[nT]);if(b3!==this.gl.FRAMEBUFFER_COMPLETE)return 0;b2[mH]=!0;this.gl[pN](this.gl[nT],null);return 1}dropFramebuffer(b4){if(b4[lc])this.gl[pX](b4[lc]);b4[mH]=!1}egg_texture_del(b5){if(b5<=1)return;const b6=this[lv][b5];if(!b6)return;this[lv][b5]=null;if(b6[mL])this.gl.deleteTexture(b6[mL]);if(b6[lc])this.gl[pX](b6[lc])}egg_texture_new(){let b7=2;for(;this[lv][b7];b7++);const b8={gltexid:0,border:0,w:0,h:0,fbid:0};if(!this[pL](b8))return-1;this[lv][b7]=b8;return b7}egg_texture_get_size(b9,ca,cc){b9>>=2;ca>>=2;const cd=this.rt[lb][m4]();if(b9<0||b9>=cd[mi]||ca<0||ca>=cd[mi])return;const ce=this[lv][cc];if(!ce)return;cd[b9]=ce.w;cd[ca]=ce.h}egg_texture_load_image(cf,cg){const ci=this[lv][cf];if(!ci)return-1;const cj=this.rt[mf][cg];if(!cj)return-1;if(cf===1){if(ci.w!==cj[pd]||ci.h!==cj[pv])return-1}else{this.dropFramebuffer(ci)}if(!this[pL](ci))return-1;this.gl[nY](this.gl[nz],ci[mL]);this.gl[nP](this.gl[nz],0,this.gl[k5],this.gl[k5],this.gl[ph],cj);ci.w=cj[pd];ci.h=cj[pv];return 0}egg_texture_load_raw(ck,cl,cm,cn,co,cp){if(cl<1||cl>bA||cm<1||cm>bA)return-1;const cq=this[lv][ck];if(!cq)return-1;if(ck===1){if(cq.w!==cl||cq.h!==cm)return-1}const cr=cl*4;if(cn<1)cn=cr;else if(cn<cr)return-1;const cs=cn*cm;if(cp&&cp<cs)return-1;let ct=null;if(co||cp){if(!(ct=this.rt[lb][nk](co,cp)))return-1}if(!this[pL](cq))return-1;this.gl[nY](this.gl[nz],cq[mL]);if(ct){if(cn>cr){ct=this.rewriteTexture(ct,cm,cr,cn)}cq[l5]=0;this.gl[nP](this.gl[nz],0,this.gl[k5],cl,cm,0,this.gl[k5],this.gl[ph],ct)}else{cq[l5]=32;this.gl[nP](this.gl[nz],0,this.gl[k5],cl+cq[l5]*2,cm+cq[l5]*2,0,this.gl[k5],this.gl[ph],null)}cq.w=cl;cq.h=cm;return 0}rewriteTexture(cu,cv,cw,cx){const cy=new Uint8Array(cw*cv);for(let cz=0,cA=0,cB=cv;cB-->0;cz+=cw,cA+=cx){const cC=new Uint8Array(cu[l6],cu[nE]+cA,cw);const cD=new Uint8Array(cy[l6],cy[nE]+cz,cw);cD.set(cC)}return cy}egg_texture_get_pixels(cE,cF,cG){const cH=this[lv][cG];if(!cH)return-1;const cI=cH.w*4;const cJ=cI*cH.h;if(cJ>cF)return-1;const cK=this.rt[lb][nk](cE,cJ);if(!cK)return-1;if(!this[p2](cH))return-1;this.gl.flush();this.gl[pN](this.gl[nT],cH[lc]);this.gl.readPixels(cH[l5],cH[l5],cH.w,cH.h,this.gl[k5],this.gl[ph],cK);return 0}egg_texture_clear(cL){const cM=this[lv][cL];if(!cM)return;if(!this[p2](cM))return;this.gl[pN](this.gl[nT],cM[lc]);this.gl[nG](0,0,0,0);this.gl[lF](this.gl[pT])}readUniforms(cN){if(!cN)return null;const cO=this.rt[lb][nk](cN,18);return{mode:cO[0]|cO[1]<<8|cO[2]<<16|cO[3]<<24,dsttexid:cO[4]|cO[5]<<8|cO[6]<<16|cO[7]<<24,srctexid:cO[8]|cO[9]<<8|cO[10]<<16|cO[11]<<24,ta:cO[12],tb:cO[13],tg:cO[14],tr:cO[15],alpha:cO[16],filter:cO[17]}}egg_render(cP,cQ,cR){const cS=typeof cP==="number"?this.readUniforms(cP):cP;if(!cS)return;if(!cS[m0])return;if(cQ instanceof Uint8Array)cR=cQ[mi];const cT=typeof cQ==="number"?this.rt[lb][nk](cQ,cR):cQ;if(!cT)return;let cU=this.gl.POINTS;let cV,cW,cX;switch(cS[lk]){case 1:cV=12;break;case 2:cV=12;cU=this.gl.LINES;break;case 3:cV=12;cU=this.gl.LINE_STRIP;break;case 4:cV=12;cU=this.gl.TRIANGLES;break;case 5:cV=12;cU=this.gl[pC];break;case 6:cV=6;cW=this[m9];break;case 7:cV=16;cW=this[nn];break;default:return;}if((cR=Math[lI](cR/cV))<1)return;if(!cW){if(cS[nb])cW=this[mU];else cW=this[mT]}if(cW===this[mT])cX=this.u_raw;else if(cW===this[mU])cX=this[l_];else if(cW===this[m9])cX=this.u_tile;else cX=this.u_fancy;let cY=null;if(cS[nb]){if(!(cY=this[lv][cS[nb]]))return}let cZ=this[lv][cS[m0]];if(!cZ||!this[p2](cZ))return;if(cZ!==this[n4]){this.gl[pN](this.gl[nT],cZ[lc]);this.gl[ng](0,0,cZ.w+cZ[l5]*2,cZ.h+cZ[l5]*2);this[n4]=cZ}this.gl[nR](cW);this.gl[nx](cX[n7],cZ.w,cZ.h);this.gl[nv](cX[nQ],cZ[l5]);if(cY){this.gl[nx](cX[nf],cY.w,cY.h);this.gl[nv](cX[nS],cY[l5]);this.gl[nw](cX[ne],0);this.gl[pk](this.gl[m$]);this.gl[nY](this.gl[nz],cY[mL]);if(cS[mb]){this.gl[pA](this.gl[nz],this.gl[p0],this.gl[l4]);this.gl[pA](this.gl[nz],this.gl[p$],this.gl[l4])}else{this.gl[pA](this.gl[nz],this.gl[p0],this.gl[mB]);this.gl[pA](this.gl[nz],this.gl[p$],this.gl[mB])}}this.gl[ny](cX[l0],cS.tr/255,cS.tg/255,cS.tb/255,cS.ta/255);this.gl[nv](cX[mz],cS.alpha/255);this.gl[nB](this.gl[n8],this[l6]);this.gl[nC](this.gl[n8],cT,this.gl[nU]);if(cW===this[mT]){this.gl[qa](0);this.gl[qa](1);this.gl[p5](0,2,this.gl[lB],!1,12,0);this.gl[p5](1,4,this.gl[ph],!0,12,8);this.gl[nI](cU,0,cR);this.gl[qb](0);this.gl[qb](1)}else if(cW===this[mU]){this.gl[qa](0);this.gl[qa](1);this.gl[p5](0,2,this.gl[lB],!1,12,0);this.gl[p5](1,2,this.gl[lB],!1,12,4);this.gl[nI](cU,0,cR);this.gl[qb](0);this.gl[qb](1)}else if(cW===this[m9]){this.gl[qa](0);this.gl[qa](1);this.gl[qa](2);this.gl[p5](0,2,this.gl[lB],!1,6,0);this.gl[p5](1,1,this.gl[ph],!1,6,4);this.gl[p5](2,1,this.gl[ph],!1,6,5);this.gl[nI](cU,0,cR);this.gl[qb](0);this.gl[qb](1);this.gl[qb](2)}else if(cW===this[nn]){this.gl[qa](0);this.gl[qa](1);this.gl[qa](2);this.gl[qa](3);this.gl[qa](4);this.gl[qa](5);this.gl[qa](6);this.gl[p5](0,2,this.gl[lB],!1,16,0);this.gl[p5](1,1,this.gl[ph],!1,16,4);this.gl[p5](2,1,this.gl[ph],!1,16,5);this.gl[p5](3,1,this.gl[ph],!0,16,6);this.gl[p5](4,1,this.gl[ph],!1,16,7);this.gl[p5](5,4,this.gl[ph],!0,16,8);this.gl[p5](6,4,this.gl[ph],!0,16,12);this.gl[nI](cU,0,cR);this.gl[qb](0);this.gl[qb](1);this.gl[qb](2);this.gl[qb](3);this.gl[qb](4);this.gl[qb](5);this.gl[qb](6)}}}bB[lf]={raw_v:"\nprecision mediump float;\nuniform vec2 uscreensize;\nuniform vec2 usrcsize;\nuniform float udstborder;\nuniform float usrcborder;\nuniform vec4 utint;\nuniform float ualpha;\nattribute vec2 apos;\nattribute vec4 acolor;\nvarying vec4 vcolor;\nvoid main() {\nvec2 npos=vec2(\n((udstborder+apos.x)*2.0)/(udstborder*2.0+uscreensize.x)-1.0,\n((udstborder+apos.y)*2.0)/(udstborder*2.0+uscreensize.y)-1.0\n);\ngl_Position=vec4(npos,0.0,1.0);\nvcolor=vec4(mix(acolor.rgb,utint.rgb,utint.a),acolor.a*ualpha);\n}\n",raw_f:"\nprecision mediump float;\nvarying vec4 vcolor;\nvoid main() {\ngl_FragColor=vcolor;\n}\n",tex_v:"\nuniform vec2 uscreensize;\nuniform vec2 usrcsize;\nuniform float udstborder;\nuniform float usrcborder;\nattribute vec2 apos;\nattribute vec2 atexcoord;\nvarying vec2 vtexcoord;\nvoid main() {\nvec2 npos=vec2(\n((udstborder+apos.x)*2.0)/(udstborder*2.0+uscreensize.x)-1.0,\n((udstborder+apos.y)*2.0)/(udstborder*2.0+uscreensize.y)-1.0\n);\ngl_Position=vec4(npos,0.0,1.0);\nvtexcoord=(atexcoord+usrcborder)/(usrcsize+usrcborder*2.0);\n}\n",tex_f:"\nprecision mediump float;\nuniform sampler2D usampler;\nuniform vec4 utint;\nuniform float ualpha;\nvarying vec2 vtexcoord;\nvoid main() {\nvec4 tcolor=texture2D(usampler,vtexcoord);\ngl_FragColor=vec4(mix(tcolor.rgb,utint.rgb,utint.a),tcolor.a*ualpha);\n}\n",tile_v:"\nprecision mediump float;\nuniform vec2 uscreensize;\nuniform vec2 usrcsize;\nuniform float udstborder;\nuniform float usrcborder;\nuniform vec4 utint;\nuniform float ualpha;\nattribute vec2 apos;\nattribute float atileid;\nattribute float axform;\nvarying vec2 vsrcp;\nvarying mat2 vmat;\nvoid main() {\nvec2 npos=vec2(\n((udstborder+apos.x)*2.0)/(udstborder*2.0+uscreensize.x)-1.0,\n((udstborder+apos.y)*2.0)/(udstborder*2.0+uscreensize.y)-1.0\n);\ngl_Position=vec4(npos,0.0,1.0);\ngl_PointSize=usrcsize.x/16.0;\nvsrcp=vec2(\nmod(atileid,16.0),\nfloor(atileid/16.0)\n)/16.0;\nif (axform<0.5) vmat=mat2( 1.0, 0.0, 0.0, 1.0); // no xform\nelse if (axform<1.5) vmat=mat2(-1.0, 0.0, 0.0, 1.0); // XREV\nelse if (axform<2.5) vmat=mat2( 1.0, 0.0, 0.0,-1.0); // YREV\nelse if (axform<3.5) vmat=mat2(-1.0, 0.0, 0.0,-1.0); // XREV|YREV\nelse if (axform<4.5) vmat=mat2( 0.0, 1.0, 1.0, 0.0); // SWAP\nelse if (axform<5.5) vmat=mat2( 0.0, 1.0,-1.0, 0.0); // SWAP|XREV\nelse if (axform<6.5) vmat=mat2( 0.0,-1.0, 1.0, 0.0); // SWAP|YREV\nelse if (axform<7.5) vmat=mat2( 0.0,-1.0,-1.0, 0.0); // SWAP|XREV|YREV\nelse vmat=mat2( 1.0, 0.0, 0.0, 1.0); // invalid; use identity\n}\n",tile_f:"\nprecision mediump float;\nuniform sampler2D usampler;\nuniform float ualpha;\nuniform vec4 utint;\nuniform float usrcborder;\nuniform vec2 usrcsize;\nvarying vec2 vsrcp;\nvarying mat2 vmat;\nvoid main() {\nvec2 texcoord=gl_PointCoord;\ntexcoord.y=1.0-texcoord.y;\ntexcoord=vmat*(texcoord-0.5)+0.5;\ntexcoord=vsrcp+texcoord/16.0;\ntexcoord=vec2(\ntexcoord.x*(1.0-(usrcborder*2.0)/usrcsize.x)+usrcborder/usrcsize.x,\ntexcoord.y*(1.0-(usrcborder*2.0)/usrcsize.y)+usrcborder/usrcsize.y\n);\ngl_FragColor=texture2D(usampler,texcoord);\ngl_FragColor=vec4(mix(gl_FragColor.rgb,utint.rgb,utint.a),gl_FragColor.a*ualpha);\n}\n",fancy_v:"\nprecision mediump float;\nuniform vec2 uscreensize;\nuniform vec2 usrcsize;\nuniform float udstborder;\nuniform float usrcborder;\nuniform vec4 utint;\nuniform float ualpha;\nattribute vec2 apos;\nattribute float atileid;\nattribute float axform;\nattribute float arotation;\nattribute float asize;\nattribute vec4 atint;\nattribute vec4 aprimary;\nvarying vec2 vsrcp;\nvarying mat2 vmat;\nvarying vec4 vtint;\nvarying vec4 vprimary;\nvoid main() {\nvec2 npos=vec2(\n((udstborder+apos.x)*2.0)/(udstborder*2.0+uscreensize.x)-1.0,\n((udstborder+apos.y)*2.0)/(udstborder*2.0+uscreensize.y)-1.0\n);\ngl_Position=vec4(npos,0.0,1.0);\ngl_PointSize=asize;\nvsrcp=vec2(\nmod(atileid,16.0),\nfloor(atileid/16.0)\n)/16.0;\nif (arotation>0.0) {\nfloat scale=(asize/(usrcsize.x/16.0));\nfloat t=arotation*-3.14159*2.0;\nif (((axform>0.5)&&(axform<2.5))||((axform>4.5)&&(axform<7.5))) {\nt=-t;\n}\nscale*=sqrt(2.0);\nfloat cost=cos(t)*sqrt(2.0);\nfloat sint=sin(t)*sqrt(2.0);\nvmat=mat2(cost,sint,-sint,cost);\ngl_PointSize*=sqrt(2.0);\n} else {\nvmat=mat2(1.0,0.0,0.0,1.0);\n}\nif (axform<0.5) ;\nelse if (axform<1.5) vmat=mat2(-vmat[0][0],-vmat[0][1], vmat[1][0], vmat[1][1]);\nelse if (axform<2.5) vmat=mat2( vmat[0][0], vmat[0][1],-vmat[1][0],-vmat[1][1]);\nelse if (axform<3.5) vmat=mat2(-vmat[0][0],-vmat[0][1],-vmat[1][0],-vmat[1][1]);\nelse if (axform<4.5) vmat=mat2( vmat[0][1], vmat[0][0], vmat[1][1], vmat[1][0]);\nelse if (axform<5.5) vmat=mat2(-vmat[0][1], vmat[0][0],-vmat[1][1], vmat[1][0]);\nelse if (axform<6.5) vmat=mat2( vmat[0][1],-vmat[0][0], vmat[1][1],-vmat[1][0]);\nelse if (axform<7.5) vmat=mat2( vmat[0][1],-vmat[0][0],-vmat[1][1], vmat[1][0]);\nvtint=atint;\nvprimary=aprimary;\n}\n",fancy_f:"\nprecision mediump float;\nuniform sampler2D usampler;\nuniform float ualpha;\nuniform vec4 utint;\nuniform float usrcborder;\nuniform vec2 usrcsize;\nvarying vec2 vsrcp;\nvarying mat2 vmat;\nvarying vec4 vtint;\nvarying vec4 vprimary;\nvoid main() {\nvec2 texcoord=gl_PointCoord;\ntexcoord.y=1.0-texcoord.y;\ntexcoord=vmat*(texcoord-0.5)+0.5;\nif ((texcoord.x<0.0)||(texcoord.y<0.0)||(texcoord.x>=1.0)||(texcoord.y>=1.0)) discard;\ntexcoord=vsrcp+texcoord/16.0;\ntexcoord=vec2(\ntexcoord.x*(1.0-(usrcborder*2.0)/usrcsize.x)+usrcborder/usrcsize.x,\ntexcoord.y*(1.0-(usrcborder*2.0)/usrcsize.y)+usrcborder/usrcsize.y\n);\ngl_FragColor=texture2D(usampler,texcoord);\nif ((gl_FragColor.r==gl_FragColor.g)&&(gl_FragColor.g==gl_FragColor.b)) {\nif (gl_FragColor.r<0.5) {\ngl_FragColor=vec4(vprimary.rgb*(gl_FragColor.r*2.0),gl_FragColor.a);\n} else {\ngl_FragColor=vec4(mix(vprimary.rgb,vec3(1.0,1.0,1.0),(gl_FragColor.r-0.5)*2.0),gl_FragColor.a);\n}\n}\ngl_FragColor=vec4(mix(gl_FragColor.rgb,vtint.rgb,vtint.a),gl_FragColor.a*vprimary.a);\ngl_FragColor=vec4(mix(gl_FragColor.rgb,utint.rgb,utint.a),gl_FragColor.a*ualpha);\n}\n"};const c_="class EggAudio extends AudioWorkletProcessor {constructor(args) {super(args);this.memory = new WebAssembly.Memory({ initial: 100, maximum: 2000 });this.buffers = [];this.bufferSize = 128;this.deferredSongs = [];this.port.onmessage = m => {switch (m.data.cmd) {case 'init': this.init(m.data); break;case 'reinit': this.reinit(m.data); break;case 'playSong': this.playSong(m.data, true); break;case 'playSound': this.playSound(m.data); break;case 'setPlayhead': this.setPlayhead(m.data); break;case 'printWave': this.printWave(m.data); break;case 'set': this.setProp(m.data); break;case 'noteOn': this.noteOn(m.data); break;case 'noteOff': this.noteOff(m.data); break;case 'noteOnce': this.noteOnce(m.data); break;case 'wheel': this.wheel(m.data); break;}};}init(m) {if (this.instance) throw new Error(`EggAudio multiple instantiation.`);this.rate = m.r;this.chanc = m.c;WebAssembly.instantiate(m.wasm, {env: {memory: this.memory,logint: n => console.log(n),},}).then(rsp => {this.instance = rsp.instance;"+"if (this.instance.exports.synth_init(this.rate, this.chanc, this.bufferSize) < 0) {"+"throw new Error(`synth_init failed`);"+"}"+"this.transferRom(m.rom);"+"this.acquireBuffers();"+"for (const req of this.deferredSongs) this.playSong(req, false);"+"this.deferredSongs = [];"+"}).catch(e => {"+"console.error(e);"+"});"+"}"+"reinit(m) {"+"if (!this.instance) return;"+"this.transferRom(m.rom);"+"}"+"transferRom(rom) {"+"if (rom instanceof ArrayBuffer) rom = new Uint8Array(rom);"+"if (rom) {"+"const dstp = this.instance.exports.synth_get_rom(rom.byteLength);"+"const dst = new Uint8Array(this.memory.buffer, dstp, rom.byteLength);"+"dst.set(rom);"+"} else {"+"this.instance.exports.synth_get_rom(0);"+"}"+"}"+"acquireBuffers() {"+"for (let c=0; c<this.chanc; c++) {"+"const p = this.instance.exports.synth_get_buffer(c);"+"if (!p) throw new Error(`Buffer for channel ${c}/${this.chanc} was not provided.`);"+"this.buffers[c] = new Float32Array(this.memory.buffer, p, this.bufferSize);"+"}"+"}"+"playSong(m, deferrable) {"+"if (!this.instance) {"+"if (deferrable) this.deferredSongs.push(m);"+"return;"+"}"+"this.instance.exports.synth_play_song(m.songid, m.rid, m.repeat, m.trim, m.pan);"+"}"+"playSound(m) {"+"if (!this.instance) return;"+"this.instance.exports.synth_play_sound(m.rid, m.trim, m.pan);"+"}"+"setProp(m) {"+"if (!this.instance) return;"+"this.instance.exports.synth_set(m.songid, m.chid, m.prop, m.v);"+"}"+"noteOn(m) {"+"if (!this.instance) return;"+"this.instance.exports.synth_event_note_on(m.songid, m.chid, m.noteid, m.velocity);"+"}"+"noteOff(m) {"+"if (!this.instance) return;"+"this.instance.exports.synth_event_note_off(m.songid, m.chid, m.noteid);"+"}"+"noteOnce(m) {"+"if (!this.instance) return;"+"this.instance.exports.synth_event_note_once(m.songid, m.chid, m.noteid, m.velocity, m.durms);"+"}"+"wheel(m) {"+"if (!this.instance) return;"+"this.instance.exports.synth_set(m.songid, m.chid, 6, m.v / 8192);"+"}"+"setPlayhead(m) {"+"if (!this.instance) return;"+"this.instance.exports.synth_set(m.songid, 0xff, 3, m.ph);"+"}"+"printWave(m) {"+"const serialp = this.instance.exports.synth_wave_prepare(m.serial.length);"+"new Uint8Array(this.memory.buffer, serialp, m.serial.length).set(m.serial);"+"const pcmp = this.instance.exports.synth_wave_preview();"+"const pcm = new Float32Array(this.memory.buffer, pcmp, 1024);"+"this.port.postMessage({ cmd: 'wavePreview', pcm, cookie: m.cookie });"+"}"+"process(i, o, p) {"+"if (!this.instance) return true;"+"const output = o[0];"+"if (output[0].length !== this.bufferSize) throw new Error(`got ${output[0].length}-frame buffer from WebAudio, expected ${this.bufferSize}`);"+"this.instance.exports.synth_update(this.bufferSize);"+"for (let c=0; c<output.length; c++) {"+"output[c].set(this.buffers[c]);"+"}"+"return true;"+"}"+"}"+"registerProcessor('AWP', EggAudio);"+"";class c${constructor(c0){this.rt=c0;this.ctx=null;this[lQ]=!1;this[nL]=0;this[p_]=[];this[pJ]=1;this[nm]=99;this[nq]=99;this[pz]=[];this[pF]=[];this[n$]=this.init()[lw](()=>{this[nL]=1})[lE](e=>{console[lH](e);this[nL]=-1})}init(){this[lQ]=!1;if(!window.AudioContext)return Promise[mq]("AudioContext not defined");const c1=new Blob([c_],{type:"text/javascript"});const c2=URL[pO](c1);this.ctx=new AudioContext({latencyHint:"interactive"});if(!this.ctx[n9])return Promise[mq]("AudioWorklet not defined");let c3,c4;const c5=new Promise((c6,c7)=>{c3=c6;c4=c7})[lw](()=>{this[ln]=new AudioWorkletNode(this.ctx,"AWP",{numberOfInputs:0,numberOfOutputs:1,outputChannelCount:[this.ctx[n_][pa]]});this[ln].connect(this.ctx[n_]);this[ln][lp].onmessage=e=>this.onWorkerMessage(e.data);return this.acquireWasm()})[lw](wasm=>{this[ln][lp][n1]({cmd:"init",rom:this.sliceRom(this.rt?.rom?.[mu]),wasm,r:this.ctx.sampleRate,c:this.ctx[n_][pa]});this[lQ]=!0});this.ctx[n9].addModule(c2)[lw](()=>{URL[pR](c2);if(this.ctx[lW]==="suspended"){window[pU]("click",()=>{this.ctx[mt]()[lw](c3)},{once:!0})}else{c3()}})[lE](e=>{URL[pR](c2);c4(e)});return c5}sliceRom(c8){if(!c8||c8[mi]<4)return c8;if(c8[0]!==0||c8[1]!==69||c8[2]!==82||c8[3]!==77)return c8;let c9=4,ea=c8[mi],eb=0;for(let ec=4,ed=1;ec<c8[mi];){const ee=c8[ec++];if(!ee)break;switch(ee&192){case 0:{const ef=ed+ee;if(!eb&&ef>=5){c9=ec;eb=ef}if(ef>6){ea=ec-1;ec=c8[mi]}ed=ef}break;case 64:ec++;break;case 128:{const eg=((ee&63)<<16|c8[ec]<<8|c8[(ec+1)])+1;ec+=2;ec+=eg}break;case 192:return c8;}}if(!eb)return new Uint8Array(0);if(eb===6){const eh=ea-c9;const ei=new Uint8Array(1+eh);ei[0]=1;new Uint8Array(ei[l6],ei[nE]+1,eh).set(new Uint8Array(c8[l6],c8[nE]+c9,ea-c9));return ei}return c8[lS](c9,ea)}acquireWasm(){return fetch("./synth.wasm")[lw](rsp=>{if(!rsp.ok)throw rsp;return rsp[nW]()})}pause(){if(!this.ctx)return;this.ctx[mY]()}resume(){if(!this.ctx)return;this.ctx[mt]()}start(){if(this[nL]<0)return;if(this[nL]>0)this[nc]();else this[n$][lw](()=>this[nc]())}startNow(){if(this.ctx[lW]==="suspended"){this.ctx[mt]()}this[lQ]=!0}stop(){if(this.ctx){this.ctx[mY]()}this[lQ]=!1}update(){}playEauSong(ej,ek){if(ej instanceof ArrayBuffer)ej=new Uint8Array(ej);if(ej&&ej[mi]>4194303)return;if(!this[lQ])return;let el=null;if(ej){el=new Uint8Array(ej[mi]+3);el[0]=128|ej[mi]-1>>16;el[1]=ej[mi]-1>>8;el[2]=ej[mi]-1;new Uint8Array(el[l6],el[nE]+3,ej[mi]).set(ej)}this[ln][lp][n1]({cmd:"reinit",rom:el});this[ln][lp][n1]({cmd:"playSong",songid:1,rid:1,repeat:ek,trim:1,pan:0});this[pz][1]={rid:1,startTime:this.ctx[nZ],duration:ej?this[p8](ej):0}}sendEvent(em){if(!this[ln])return;switch(em.opcode){case 128:this[ln][lp][n1]({cmd:"noteOff",songid:1,chid:em[k8],noteid:em.a,velocity:em.b});break;case 144:this[ln][lp][n1]({cmd:"noteOn",songid:1,chid:em[k8],noteid:em.a,velocity:em.b});break;case 224:this[ln][lp][n1]({cmd:"wheel",songid:1,chid:em[k8],v:(em.a|em.b<<7)-8192});break;}}calculateSongDuration(en){let eo=0;if(en[mi]>=10){const ep=en[6]<<24|en[7]<<16|en[8]<<8|en[9];let eq=10;if(ep>=0&&eq<=en[mi]-ep-4){eq+=ep;const er=en[eq]<<24|en[(eq+1)]<<16|en[(eq+2)]<<8|en[(eq+3)];eq+=4;if(er>=0&&eq<=en[mi]-er){const es=eq+er;while(eq<es){const et=en[eq++];if(!(et&128)){if(et&64)eo+=(et&63)+1<<6;else eo+=et}else switch(et&240){case 128:eq+=2;break;case 144:eq+=2;break;case 160:eq+=3;break;case 224:eq+=2;break;case 240:break;default:eq=es;}}}}}if(eo<1)eo=1;return eo/1000}durationByRid(eu){let ev=this[pF][eu];if(typeof ev==="number")return ev;const ew=this.rt.rom[md](5,eu);if(ew){ev=this[p8](ew)}else{ev=0}this[pF][eu]=ev;return ev}printWave(ex){const ey=this[pJ]++;let ez,eA;const eB=new Promise((eC,eD)=>{ez=eC;eA=eD});this[p_][lq]({cookie:ey,promise:eB,resolve:ez,reject:eA});this[ln][lp][n1]({cmd:"printWave",serial:ex,cookie:ey});return eB}onWorkerMessage(eE){switch(eE.cmd){case"wavePreview":{const eF=this[p_][nj](w=>w[l8]===eE[l8]);if(eF<0)break;const eG=this[p_][eF];this[p_][mv](eF,1);eG.resolve(eE.pcm)}break;}}getNormalizedPlayhead(){if(!this.ctx)return 0;const eH=this[pz][1];if(eH?.[m1]){return((this.ctx[nZ]-eH[nr])%eH[m1])/eH[m1]}return 0}setNormalizedPlayhead(eI){if(!this.ctx)return;const eJ=this[pz][1];if(eJ?.[m1]){const eK=eI*eJ[m1];this[ln][lp][n1]({cmd:"setPlayhead",songid:1,ph:eK});eJ[nr]=this.ctx[nZ]-eK}}setMusicTrim(eL){if(isNaN(eL)||eL<0||eL>99)return;if(eL===this[nm])return;this[nm]=eL;this[ln][lp][n1]({cmd:"set",songid:0,chid:0,prop:7,v:eL/99})}setSoundTrim(eM){if(isNaN(eM)||eM<0||eM>99)return;if(eM===this[nq])return;this[nq]=eM;this[ln][lp][n1]({cmd:"set",songid:0,chid:0,prop:8,v:eM/99})}egg_play_sound(eN,eO,eP){if(eN<1)return;if(!this[lQ])return;this[ln][lp][n1]({cmd:"playSound",rid:eN,trim:eO,pan:eP})}egg_play_song(eQ,eR,eS,eT,eU){if(eQ<1)return;if(!this[lQ]){this[n$][lw](()=>{if(this[lQ])this[po](eQ,eR,eS,eT,eU)});return}this[ln][lp][n1]({cmd:"playSong",songid:eQ,rid:eR,repeat:eS,trim:eT,pan:eU});this[pz][eQ]={rid:eR,startTime:this.ctx[nZ]}}egg_song_set(eV,eW,eX,eY){if(!this[lQ])return;this[ln][lp][n1]({cmd:"set",songid:eV,chid:eW,prop:eX,v:eY});if(eX===3){const eZ=this[pz][eV];if(eZ){eZ[nr]=eY-this.ctx[nZ]}}}egg_song_event_note_on(e_,e$,e0,e1){if(!this[lQ])return;this[ln][lp][n1]({cmd:"noteOn",songid:e_,chid:e$,noteid:e0,velocity:e1})}egg_song_event_note_off(e2,e3,e4){if(!this[lQ])return;this[ln][lp][n1]({cmd:"noteOff",songid:e2,chid:e3,noteid:e4})}egg_song_event_note_once(e5,e6,e7,e8,e9){if(!this[lQ])return;this[ln][lp][n1]({cmd:"noteOnce",songid:e5,chid:e6,noteid:e7,velocity:e8,durms:e9})}egg_song_event_wheel(fa,fc,fd){if(!this[lQ])return;this[ln][lp][n1]({cmd:"wheel",songid:fa,chid:fc,v:fd})}egg_song_get_playhead(fe){const ff=this[pz][fe];if(ff){if(!ff[m1])ff[m1]=this.durationByRid(ff.rid);return Math.max(.001,(this.ctx[nZ]-ff[nr])%ff[m1])}return 0}}c$.singleton=!0;class fg{constructor(fh){this.rt=fh;this.gpx=0;this.gpy=0;this.gpw=0;this.gph=0;this[mE]=[];this[mD]=-1;this[mc]=0;this[lG]=null;this[pb]=null;this[nX]=[];this[mZ]=15}stop(){const fi=document[pw]("#incfg");if(fi)fi[mr]();this.rt[lL]=null;this.rt[lN].endRawMode(this[nX])}start(){const fj=document[pw]("#fbouter");this[l7]=document[pm]("CANVAS");this[l7].id="incfg";const fk=this.rt[l2][l7];const fl=fk[p9]();this[l7][lX][li]=fl.x+"px";this[l7][lX].top=fl.y+"px";this[l7][lX][l3]=fl[l3]+"px";this[l7][lX][me]=fl[me]+"px";this[l7][l3]=fk[l3];this[l7][me]=fk[me];fj[nV](this[l7]);this.layout();const fm=this.rt.rom[mK]("incfgMask")||"dswen123lrLR";let fn=+this.rt.rom[mK]("incfgNames");const fo=[];const fp=fq=>{if(!fq)return;const fr=this[mE][nj](b=>b[lD]===fq);if(fr<0)return;const fs=this[mE][fr];this[mE][mv](fr,1);fs[ma]=!0;if(fn)fs[lm]=this.rt.rom[nl](this.rt[lh],1,fn);fo[lq](fs);return fs};for(const ch of fm){let ft=0;if(ch==="d"){let fu="";if(fn){fu=this.rt.rom[nl](this.rt[lh],1,fn);fn++}fp(1)[lm]=fu;fp(2)[lm]=fu;fp(4)[lm]=fu;fp(8)[lm]=fu}else{let fv="",fw=null;if(fn){fv=this.rt.rom[nl](this.rt[lh],1,fn);fn++}switch(ch){case"s":fw=fp(16);break;case"w":fw=fp(32);break;case"e":fw=fp(64);break;case"n":fw=fp(128);break;case"l":fw=fp(256);break;case"r":fw=fp(512);break;case"L":fw=fp(1024);break;case"R":fw=fp(2048);break;case"1":fw=fp(4096);break;case"2":fw=fp(8192);break;case"3":fw=fp(16384);break;}if(fw)fw[lm]=fv}}for(const button of this[mE])fo[lq](button);this[mE]=fo;this.rt[lN].beginRawMode((fx,fy,fz)=>this.onRawInput(fx,fy,fz))}layout(){const fA=this[l7][l3],fB=this[l7][me];this.gpw=Math.max(40,Math[lI](fA/3));this.gph=this.gpw>>1;this.gpx=(fA>>1)-(this.gpw>>1)+.5;this.gpy=(fB>>1)-(this.gph>>1)+.5;const fC=this.gpx+Math[lI]((this.gpw*1)/16);const fD=this.gpx+Math[lI]((this.gpw*2)/16);const fE=this.gpx+Math[lI]((this.gpw*3)/16);const fF=this.gpx+Math[lI]((this.gpw*5)/16);const fG=this.gpx+Math[lI]((this.gpw*6)/16);const fH=this.gpx+Math[lI]((this.gpw*7)/16);const fI=this.gpx+Math[lI]((this.gpw*8)/16);const fJ=this.gpx+Math[lI]((this.gpw*9)/16);const fK=this.gpx+Math[lI]((this.gpw*10)/16);const fL=this.gpx+Math[lI]((this.gpw*11)/16);const fM=this.gpx+Math[lI]((this.gpw*13)/16);const fN=this.gpx+Math[lI]((this.gpw*14)/16);const fO=this.gpx+Math[lI]((this.gpw*15)/16);const fP=this.gpy-Math[lI]((this.gph*1)/8);const fQ=this.gpy+Math[lI]((this.gph*1)/8);const fR=this.gpy+Math[lI]((this.gph*3)/8);const fS=this.gpy+Math[lI]((this.gph*5)/8);const fT=this.gpy+Math[lI]((this.gph*6)/8);const fU=this.gpy+Math[lI]((this.gph*7)/8);this[mE][lq]({btnid:1,x:fC,y:fR,w:fE-fC,h:fS-fR});this[mE][lq]({btnid:2,x:fF,y:fR,w:fH-fF,h:fS-fR});this[mE][lq]({btnid:4,x:fE,y:fQ,w:fF-fE,h:fR-fQ});this[mE][lq]({btnid:8,x:fE,y:fS,w:fF-fE,h:fU-fS});this[mE][lq]({btnid:16,x:fL,y:fS,w:fM-fL,h:fU-fS});this[mE][lq]({btnid:32,x:fJ,y:fR,w:fL-fJ,h:fS-fR});this[mE][lq]({btnid:64,x:fM,y:fR,w:fO-fM,h:fS-fR});this[mE][lq]({btnid:128,x:fL,y:fQ,w:fM-fL,h:fR-fQ});this[mE][lq]({btnid:256,x:this.gpx,y:fP,w:fD-this.gpx,h:this.gpy-fP});this[mE][lq]({btnid:512,x:fN,y:fP,w:this.gpx+this.gpw-fN,h:this.gpy-fP});this[mE][lq]({btnid:1024,x:fE,y:fP,w:fF-fE,h:this.gpy-fP});this[mE][lq]({btnid:2048,x:fL,y:fP,w:fM-fL,h:this.gpy-fP});this[mE][lq]({btnid:4096,x:fI,y:fT,w:fK-fI,h:fU-fT});this[mE][lq]({btnid:8192,x:fG,y:fT,w:fI-fG,h:fU-fT});this[mE][lq]({btnid:16384,x:fH,y:fQ,w:fJ-fH,h:Math[lI](this.gph/8)})}advance(){if(!this[lG]){this[mD]=this[mE][mi];return}for(;;){this[mD]++;if(this[mD]>=this[mE][mi])return;const fV=this[mE][this[mD]];if(!fV[ma]||fV[la])continue;this[mZ]=10;break}}update(fW){if(this[mD]>=this[mE][mi]){this[lu]();return}if((this[mZ]-=fW)<=0){this[mC]();return}}onRawInput(fX,fY,fZ){if(!fZ)return;if(!this[lG]){this[lG]=fX;this[pb]=fX[lU]("(")[0][lx]()||"Unknown device";this[mC]();return}const f_=this[mE][this[mD]];if(f_){const f$=[fX,fY,f_[lD]];if(this.rt[lN].buttonIsAxis(fX,fY)){switch(f_[lD]){case 1:f$[2]|=2;this[nA](2);if(fZ>0)f$[1]=-f$[1];break;case 2:f$[2]|=1;this[nA](1);if(fZ<0)f$[1]=-f$[1];break;case 4:f$[2]|=8;this[nA](8);if(fZ>0)f$[1]=-f$[1];break;case 8:f$[2]|=4;this[nA](4);if(fZ<0)f$[1]=-f$[1];break;}}this[nX][lq](f$);this[mC]()}}autoAssign(f0){const f1=this[mE][le](b=>b[lD]===f0);if(!f1)return;f1[la]=!0}render(){this[mc]++;const f2=this[mc]%60>=30;const f3=this[l7][nK]("2d");f3[ni]="#000";f3.fillRect(0,0,this[l7][l3],this[l7][me]);this.renderShell(f3);let f4,f5,f6,f7;for(let f8=0;f8<this[mE][mi];f8++){const f9=this[mE][f8];f3[nh]();if(f9[lD]&240){f3[mF](f9.x+f9.w*.5,f9.y+f9.h*.5,f9.w*.5,f9.h*.5,0,0,Math.PI*2)}else{f3[lr](f9.x,f9.y,f9.w,f9.h)}if(!f9[ma])f3[ni]="#777";else if(f8===this[mD])f3[ni]=f2?"#ff0":"#800";else if(f8>this[mD])f3[ni]="#ccc";else f3[ni]="#080";f3[ld]();switch(f9[lD]){case 1:f4=f9;break;case 2:f5=f9;break;case 4:f6=f9;break;case 8:f7=f9;break;default:{if(f9[ma]){f3[n3]="#fff"}else{f3[n3]="#666"}f3[mx]()}}}if(f4&&f5&&f6&&f7){const ga=f4.x;const gb=f6.x;const gc=f5.x;const gd=f5.x+f5.w;const ge=f6.y;const gf=f4.y;const gg=f7.y;const gh=f7.y+f7.h;f3[nh]();f3[mn](ga,gf);f3[mj](ga,gg);f3[mj](gb,gg);f3[mj](gb,gh);f3[mj](gc,gh);f3[mj](gc,gg);f3[mj](gd,gg);f3[mj](gd,gf);f3[mj](gc,gf);f3[mj](gc,ge);f3[mj](gb,ge);f3[mj](gb,gf);f3[mj](ga,gf);f3[n3]="#fff";f3[mx]()}if(this[lG]){f3[nu]="center";f3[pf]="middle";f3[ni]="#ff0";f3[m2](this[pb],this[l7][l3]>>1,this.gpy>>1)}if(this[mD]>=0&&this[mD]<this[mE][mi]){const gi=this[mE][this[mD]];if(gi[lm]){f3[nu]="center";f3[pf]="middle";f3[ni]="#ff0";const gj=this.gpy+this.gph+(this[l7][me]-this.gph-this.gpy)/3;f3[m2](gi[lm],this[l7][l3]>>1,gj)}}if(this[mZ]<5){f3[nu]="center";f3[pf]="middle";f3[ni]="#f88";const gk=this.gpy+this.gph+((this[l7][me]-this.gph-this.gpy)*2)/3;f3[m2](Math.ceil(this[mZ])[nd](),this[l7][l3]>>1,gk)}}renderShell(gm){gm[nh]();gm[lr](this.gpx,this.gpy,this.gpw,this.gph);gm[ni]="#888";gm[ld]();gm[n3]="#fff";gm[mx]()}}class gn{constructor(go){this[lN]=go;this[mO]=e=>{};this[px]=null;this[mE]=[];this[lt]=[0,0];this[lW]=0;this.buildUi()}stop(){if(this[px]){window.clearTimeout(this[px]);this[px]=null}const gq=document[pG]("touch");if(gq){gq[mr]()}}buildUi(){const gr=document[pm]("CANVAS");gr.id="touch";gr[pU]("touchstart",e=>this[mR](e));gr[pU]("touchend",e=>this[mR](e));gr[pU]("touchmove",e=>this[mR](e));document[k7][nV](gr);this.renderSoon()}rebuildButtons(gs,gt){for(const button of this[mE])if(button[lW]){if(!(this[lW]&button[lD]))continue;this[lW]&=~button[lD];this[mO]({btnid:button[lD],value:0})}this[lt][0]=gs;this[lt][1]=gt;this[mE]=[];this[lW]=0;const gu=this[lN].rt.rom[mK]("incfgMask")||"dswen123lrLR";if(gu[mM]("d")>=0){const gv=Math.max(100,Math[lI](gs/4));const gw=gv;const gx=[0,Math[lR](gv/3),Math[lR](gv*.5),Math[lR]((gv*2)/3),gv];const gy=[gt-gw];gy[lq](gy[0]+Math[lR](gw/3));gy[lq](gy[0]+Math[lR](gw*.5));gy[lq](gy[0]+Math[lR]((gw*2)/3));gy[lq](gy[0]+gw);{const gz=new Path2D();gz[mn](gx[0],gy[3]);gz[mj](gx[0],gy[1]);gz[mj](gx[1],gy[1]);gz[mj](gx[2],gy[2]);gz[mj](gx[1],gy[3]);gz[mj](gx[0],gy[3]);this[mE][lq]({btnid:1,path:gz,state:!1})}{const gA=new Path2D();gA[mn](gx[4],gy[1]);gA[mj](gx[4],gy[3]);gA[mj](gx[3],gy[3]);gA[mj](gx[2],gy[2]);gA[mj](gx[3],gy[1]);gA[mj](gx[4],gy[1]);this[mE][lq]({btnid:2,path:gA,state:!1})}{const gB=new Path2D();gB[mn](gx[1],gy[0]);gB[mj](gx[3],gy[0]);gB[mj](gx[3],gy[1]);gB[mj](gx[2],gy[2]);gB[mj](gx[1],gy[1]);gB[mj](gx[1],gy[0]);this[mE][lq]({btnid:4,path:gB,state:!1})}{const gC=new Path2D();gC[mn](gx[3],gy[4]);gC[mj](gx[1],gy[4]);gC[mj](gx[1],gy[3]);gC[mj](gx[2],gy[2]);gC[mj](gx[3],gy[3]);gC[mj](gx[3],gy[4]);this[mE][lq]({btnid:8,path:gC,state:!1})}}const gD=Math.max(100,Math[lI](gs/4));const gE=gD;const gF=gs-gD;const gG=gt-gE;const gH=gD/6;const gI=[gF+gH,gF+gD*.5,gF+gD-gH];const gJ=[gG+gH,gG+gE*.5,gG+gE-gH];if(gu[mM]("s")>=0){const gK=new Path2D();gK[mF](gI[1],gJ[2],gH,gH,0,0,Math.PI*2);this[mE][lq]({btnid:16,path:gK,state:!1})}if(gu[mM]("w")>=0){const gL=new Path2D();gL[mF](gI[0],gJ[1],gH,gH,0,0,Math.PI*2);this[mE][lq]({btnid:32,path:gL,state:!1})}if(gu[mM]("e")>=0){const gM=new Path2D();gM[mF](gI[2],gJ[1],gH,gH,0,0,Math.PI*2);this[mE][lq]({btnid:64,path:gM,state:!1})}if(gu[mM]("n")>=0){const gN=new Path2D();gN[mF](gI[1],gJ[0],gH,gH,0,0,Math.PI*2);this[mE][lq]({btnid:128,path:gN,state:!1})}const gO="lL321Rr";const gP=1;const gQ=Math.max(30,Math[lR](gt/8));for(let gR=0;gR<gO[mi];gR++){const gS=gO[gR];if(gu[mM](gS)<0)continue;let gT=0;switch(gS){case"l":gT=256;break;case"r":gT=512;break;case"L":gT=1024;break;case"R":gT=2048;break;case"1":gT=4096;break;case"2":gT=8192;break;case"3":gT=16384;break;default:continue;}const gU=Math[lI]((gR*gs)/gO[mi])+1;const gV=Math[lI](((gR+1)*gs)/gO[mi])-1;const gW=new Path2D();gW[lr](gU,gP,gV-gU,gQ);this[mE][lq]({btnid:gT,path:gW,state:!1})}}findButtonAtPoint(gX,gY){const gZ=document[pG]("touch");if(!gZ)return null;const g_=gZ[nK]("2d");return this[mE][le](button=>g_.isPointInPath(button[lo],gX,gY))}renderSoon(){if(this[px])return;this[px]=window.setTimeout(()=>{this[px]=null;this[no]()},100)}renderNow(){const g$=document[pG]("touch");if(!g$)return;const g0=g$[p9]();g$[l3]=g0[l3];g$[me]=g0[me];const g1=g$[nK]("2d");if(this[lt][0]!==g0[l3]||this[lt][1]!==g0[me]){this.rebuildButtons(g0[l3],g0[me])}g1.clearRect(0,0,g0[l3],g0[me]);g1.lineWidth=3;g1[ni]="#fffc";g1[n3]="#8888";for(const button of this[mE])if(button[lW]){g1[ld](button[lo])}else{g1[mx](button[lo])}}onTouch(g2){g2[pS]();g2[pK]();const g3=[];for(const touch of g2?.touches||[]){const g4=this.findButtonAtPoint(touch.clientX,touch.clientY);if(!g4)continue;if(g3[m5](g4))continue;g3[lq](g4)}let g5=!1;for(const button of this[mE])if(g3[m5](button)){if(button[lW])continue;g5=!0;button[lW]=!0;if(!(this[lW]&button[lD])){this[lW]|=button[lD];this[mO]({btnid:button[lD],value:1})}}else{if(!button[lW])continue;g5=!0;button[lW]=!1;if(this[lW]&button[lD]){this[lW]&=~button[lD];this[mO]({btnid:button[lD],value:0})}}if(g5&&!this[px]){this[no]()}}}const g6=16777217;const g7=16777218;const g8=1;const g9=2;const ha=4;const hb=8;const hc=16;const hd=32;const he=64;const hf=128;const hg=256;const hh=512;const hj=1024;const hk=2048;const hl=4096;const hm=8192;const hn=16384;const ho=32768;const hp=0;const hq=1;const hr=-1;class hs{constructor(ht){this.rt=ht;this[mw]=[32768,32768];this[mV]=1;this[n0]=null;this[m3]=[];this[lk]=hp;this[ml]=this.rt[l2].fbw>>1;this[mm]=this.rt[l2].fbh>>1;this[pu]=null;this[lP]=null;this[lZ]=null;this[pQ]=e=>this.onGamepad(e);window[pU]("gamepadconnected",this[pQ]);window[pU]("gamepaddisconnected",this[pQ]);this.loadMaps()}loadMaps(){try{this[mh]=JSON[lO](localStorage[mJ]("egg.keyMap"));if(!Object[lg](this[mh])[mi])throw null}catch(e){this[mh]=this.defaultKeyMap()}try{this[mg]=JSON[lO](localStorage[mJ]("egg.joyMap"));if(!this[mg]||typeof this[mg]!=="object")throw null}catch(e){this[mg]={}}}saveMaps(){localStorage[mX]("egg.keyMap",JSON[ns](this[mh]));localStorage[mX]("egg.joyMap",JSON[ns](this[mg]))}defaultKeyMap(){return{KeyW:ha,KeyA:g8,KeyS:hb,KeyD:g9,KeyE:hc,KeyQ:hd,KeyR:he,KeyF:hf,Space:hc,Comma:hd,Period:he,Slash:hf,ArrowLeft:g8,ArrowRight:g9,ArrowUp:ha,ArrowDown:hb,KeyZ:hc,KeyX:hd,KeyC:he,KeyV:hf,Backquote:hj,Tab:hg,Backspace:hk,Backslash:hh,Enter:hl,Numpad8:ha,Numpad4:g8,Numpad5:hb,Numpad6:g9,Numpad2:hb,Numpad7:hg,Numpad9:hh,Numpad0:hc,NumpadEnter:hd,NumpadAdd:he,NumpadDecimal:hf,NumpadSubtract:hl,Escape:g6,F11:g7}}defaultJoyMap(){return{buttons:[hc,he,hd,hf,hg,hh,hj,hk,hm,hl,hn,g6,ha,hb,g8,g9,hn],axes:[3,12]}}start(){this[mV]=1;try{const hu=this.rt.rom[mK]("players")[lU]("..");if(hu[mi]>0){this[mV]=+hu[(hu[mi]-1)]||0;if(this[mV]<1)this[mV]=1;else if(this[mV]>8)this[mV]=8}}catch(e){}this[mw]=[ho,ho];if(!this[n0]){this[n0]=e=>this.onKey(e);window[pU]("keydown",this[n0]);window[pU]("keyup",this[n0])}if(this[lk]===hq){this[p7]()}if(!this[lZ]&&this.shouldUseTouchInput()){this[lZ]=new gn(this);this[lZ][mO]=e=>this[mR](e)}}stop(){if(this[n0]){window[p4]("keydown",this[n0]);window[p4]("keyup",this[n0]);this[n0]=null}this[pY]();if(this[lZ]){this[lZ][lu]();this[lZ]=null}}update(){for(const device of navigator?.getGamepads?.()||[]){if(!device)continue;const hv=this[m3][device[lM]];if(!hv)continue;this.updateGamepad(hv,device)}if(this[lk]===hq){if(this[mw][0]&15){const hw=Math.max(1,Math[lI](this.rt[l2].fbw/150));switch(this[mw][0]&3){case g8:if((this[ml]-=hw)<0)this[ml]=-1;break;case g9:if((this[ml]+=hw)>=this.rt[l2].fbw)this[ml]=this.rt[l2].fbw;break;}switch(this[mw][0]&12){case ha:if((this[mm]-=hw)<0)this[mm]=-1;break;case hb:if((this[mm]+=hw)>=this.rt[l2].fbh)this[mm]=this.rt[l2].fbh;break;}}}}dispatchAction(hx){switch(hx){case g6:this.rt.toggleUmenu();break;case g7:console.log("TODO Input: ACTION_FULLSCREEN");break;default:console.log("Input.dispatchAction: Unknown action 0x"+hx[nd](16));}}zeroAllStates(){for(let hy=this[mw][mi];hy-->0;)this[mw][hy]&=32768;for(const gp of this[m3])if(gp)gp[lW]&=32768}beginRawMode(hz){this[mp]=this[lk];this[lk]=hr;this[lP]=hz;this[pB]()}endRawMode(hA){this[lk]=this[mp];this[lP]=null;if(hA?.[mi]){let hB=!1;for(const assignment of hA)if(this.updateAssignment(assignment[0],assignment[1],assignment[2])){hB=!0}if(hB){this.saveMaps();this.reassignLiveMaps()}}}updateAssignment(hC,hD,hE){if(!hC||!hD)return!1;if(hC==="Keyboard"){if(this[mh][hD]===hE)return!1;this[mh][hD]=hE}else{let hF=this[mg][hC];if(!hF){hF=this[pn]();this[mg][hC]=hF}if(hD>-0x200&&hD<=-0x100){const hG=-hD&255;while(hF[k6][mi]<=hG)hF[k6][lq](0);if(hF[k6][hG]===hE)return!1;hF[k6][hG]=hE}else if(hD>=256&&hD<512){const hH=hD&255;while(hF[k6][mi]<=hH)hF[k6][lq](0);if(hF[k6][hH]===hE)return!1;hF[k6][hH]=hE}else if(hD>=512&&hD<768){const hI=hD&255;while(hF[mE][mi]<=hI)hF[mE][lq](0);if(hF[mE][hI]===hE)return!1;hF[mE][hI]=hE}else{return!1}}return!0}reassignLiveMaps(){for(const gp of this[m3]){if(!gp)continue;const hJ=this[mg][gp.id];if(!hJ)continue;gp.map=hJ;gp[lW]&=ho}}buttonIsAxis(hK,hL){if(hK==="Keyboard")return!1;return hL>=256&&hL<512}shouldUseTouchInput(){return window?.navigator?.maxTouchPoints>0}onTouch(hM){if(!(hM[lD]&65535))return;if(hM[lD]===ho)return;if(hM[l1]){if(this[mw][1]&hM[lD])return;this[mw][1]|=hM[lD];this[mw][0]|=hM[lD]}else{if(!(this[mw][1]&hM[lD]))return;this[mw][1]&=~hM[lD];this[mw][0]&=~hM[lD]}}onKey(hN){if(hN.ctrlKey||hN.altKey||hN.shiftKey||hN.metaKey)return;if(this[lk]===hr){hN[pS]();hN[pK]();if(hN[ly]==="keydown"&&!hN[ms]){this[lP]("Keyboard",hN[k9],1)}return}const hO=this[mh][hN[k9]];if(!hO){return}hN[pS]();hN[pK]();if(hN[ms])return;if(hO&-65536){if(hN[ly]==="keydown")this[pE](hO);return}if(hN[ly]==="keydown"){if(this[mw][1]&hO)return;this[mw][1]|=hO;this[mw][0]|=hO}else{if(!(this[mw][1]&hO))return;this[mw][1]&=~hO;this[mw][0]&=~hO}}requireMouseListener(){if(!this[pu]&&this.rt[l2][l7]){this[pu]=e=>this.onMouse(e);this.rt[l2][l7][pU]("mousemove",this[pu]);this.rt[l2][l7][pU]("mouseenter",this[pu]);this.rt[l2][l7][pU]("mouseleave",this[pu]);this.rt[l2][l7][pU]("mousedown",this[pu]);this.rt[l2][l7][pU]("mouseup",this[pu])}}dropMouseListener(){if(this[pu]&&this.rt[l2][l7]){this.rt[l2][l7][p4]("mousemove",this[pu]);this.rt[l2][l7][p4]("mouseenter",this[pu]);this.rt[l2][l7][p4]("mouseleave",this[pu]);this.rt[l2][l7][p4]("mousedown",this[pu]);this.rt[l2][l7][p4]("mouseup",this[pu]);this[pu]=null}}onMouse(hP){switch(hP[ly]){case"mousemove":case"mouseenter":case"mouseleave":{const hQ=hP[my][p9]();this[ml]=Math.max(-1,Math.min(this.rt[l2].fbw,Math[lI](((hP.x-hQ.x)*this.rt[l2].fbw)/hQ[l3])));this[mm]=Math.max(-1,Math.min(this.rt[l2].fbh,Math[lI](((hP.y-hQ.y)*this.rt[l2].fbh)/hQ[me])))}break;case"mousedown":case"mouseup":{let hR=0;switch(hP.button){case 0:hR=hc;break;case 1:hR=he;break;case 2:hR=hd;break;}if(hR){if(hP[ly]==="mousedown")this[mw][0]|=hR;else this[mw][0]&=~hR}}break;}hP[pK]();hP[pS]()}onGamepad(hS){if(!hS?.[mI])return;if(hS[ly]==="gamepadconnected"){const hT={id:hS[mI].id,index:hS[mI][lM],axes:hS[mI][k6].map(v=>0),buttons:hS[mI][mE].map(v=>0),playerid:0,state:ho,map:this[mg][hS[mI].id]||this[pn]()};if(hT[mE][mi]>17)hT[mE]=hT[mE][lS](0,17);this[m3][hS[mI][lM]]=hT}else if(hS[ly]==="gamepaddisconnected"){const hU=this[m3][hS[mI][lM]];if(!hU)return;delete this[m3][hS[mI][lM]];if(hU[na]){this[mw][hU[na]]&=~hU[lW];this[mw][0]&=~hU[lW];this[mw][0]|=ho;this[mw][1]|=ho}}}updateGamepad(hV,hW){const hX=.25;for(let hY=hW[k6][mi];hY-->0;){let hZ=hW[k6][hY]||0;if(hZ>hX)hZ=1;else if(hZ<-0.250)hZ=-1;else hZ=0;if(hZ===hV[k6][hY])continue;if(this[lk]===hr){this[lP]?.(hW.id,256+hY,hZ);hV[k6][hY]=hZ;continue}const h_=hV.map[k6][hY];if(h_){const h$=h_&5;const h0=h_&10;if(hV[k6][hY]<0)this[pV](hV,h$,0);else if(hV[k6][hY]>0)this[pV](hV,h0,0);if(hZ<0)this[pV](hV,h$,1);else if(hZ>0)this[pV](hV,h0,1)}hV[k6][hY]=hZ}for(let h1=hV[mE][mi];h1-->0;){const h2=hW[mE][h1]?.[l1]?1:0;if(hV[mE][h1]===h2)continue;hV[mE][h1]=h2;if(this[lk]===hr){this[lP]?.(hW.id,512+h1,h2);continue}const h3=hV.map[mE][h1];if(h3&-65536){if(h2)this[pE](h3)}else if(h3){this[pV](hV,h3,h2)}}}setGamepadButton(h4,h5,h6){if(h6){if(h4[lW]&h5)return;h4[lW]|=h5;this.requireGamepadPlayer(h4);this[mw][h4[na]]|=h5;this[mw][0]|=h5}else{if(!(h4[lW]&h5))return;h4[lW]&=~h5;if(h4[na]){this[mw][h4[na]]&=~h5;this[mw][0]&=~h5}}}requireGamepadPlayer(h7){if(h7[na])return;if(this[mV]<2){h7[na]=1}else{const h8=[];for(const h7 of this[m3]){if(!h7?.[na])continue;while(h7[na]>=h8[mi])h8[lq](0);h8[h7[na]]++}h7[na]=1;for(let h9=1;h9<=this[mV];h9++)if((h8[h9]||0)<h8[h7[na]])h7[na]=h9}if(!this[mw][h7[na]])this[mw][h7[na]]=0;this[mw][h7[na]]|=ho;this[mw][h7[na]]|=ho}egg_input_configure(){if(this.rt[lL])return;this.rt[lL]=new fg(this.rt);this.rt[lL][lV]()}egg_input_get_all(ja,jb){if(ja<1||jb<1)return;ja>>=2;const jc=this.rt[lb][m4]();if(ja>jc[mi]-jb)return;const jd=ja;for(let je=0;jb-->0;je++,ja++)jc[ja]=this[mw][je]||0;if(this[lk]===hq){jc[jd]&=112}}egg_input_get_one(jf){if(!jf&&this[lk]===hq){return this[mw][0]&112}return this[mw][jf]||0}egg_input_set_mode(jg){if(jg===this[lk])return;switch(jg){case hp:{this[lk]=jg;this[mw][0]&=32768;this[pY]()}break;case hq:{this[lk]=jg;this[mw][0]&=32768;this[p7]()}break;}}egg_input_get_mouse(jh,ji){switch(this[lk]){case hq:{const jj=this.rt[lb][m4]();if(jh)jj[(jh>>2)]=this[ml];if(ji)jj[(ji>>2)]=this[mm]}return 1;}return 0}}class jk{constructor(jl){this.rt=jl;this[mp]=this.rt[lN][lk];this[mW]=65535}stop(){this.rt[lN][p1](this[mp]);this.rt[lN][pB]();const jm=document[pw]("#umenu");if(jm)jm[mr]();this.rt[l$]=null}start(){this.rt[lN][pB]();this.rt[lN][p1](0);const jn=document[pw]("#fbouter");const jo=this[lT](jn,"DIV",{id:"umenu"});const jp=this.rt[l2][l7];const jq=jp[p9]();jo[lX][li]=jq.x+"px";jo[lX].top=jq.y+"px";jo[lX][l3]=jq[l3]+"px";jo[lX][me]=jq[me]+"px";this[lT](jo,"DIV",["row"],this[lT](null,"DIV",["keyIcon"],"\u266c"),this[lT](null,"INPUT",{type:"range",min:0,max:99,value:this.rt[lC][nm],name:"music","on-input":e=>this[mP](e)}));this[lT](jo,"DIV",["row"],this[lT](null,"DIV",["keyIcon"],"\ud83d\udd0a"),this[lT](null,"INPUT",{type:"range",min:0,max:99,value:this.rt[lC][nq],name:"sound","on-input":e=>this[mQ](e)}));let jr;this[lT](jo,"DIV",["row"],this[lT](null,"DIV",["keyIcon"],"A\u2f42"),jr=this[lT](null,"SELECT",{name:"lang","on-input":e=>this[mo](e)}));const js=this.rt.rom[mK]("lang")[lU](",").map(v=>v[lx]());for(const lang of js)this[lT](jr,"OPTION",{value:this.rt[m7](lang)},lang);jr[l1]=this.rt[lh];let jt;this[lT](jo,"DIV",["row"],this[lT](null,"INPUT",{type:"button",value:"\u2328",name:"input","on-click":e=>this.onInput(e)}),jt=this[lT](null,"INPUT",{type:"button",value:"\u25b6",name:"resume","on-click":e=>this.onResume(e)}),this[lT](null,"INPUT",{type:"button",value:"\u23fb",name:"quit","on-click":e=>this.onQuit(e)}));jt[lK]()}update(ju){const jv=this.rt[lN][mw][0];if(jv!==this[mW]){const jw=this[mW];this[mW]=jv;if(jv&1&&!(jw&1))this[ll](-1,0);if(jv&2&&!(jw&2))this[ll](1,0);if(jv&4&&!(jw&4))this[ll](0,-1);if(jv&8&&!(jw&8))this[ll](0,1);if(jv&16&&!(jw&16))this.activate();if(jv&32&&!(jw&32))this.cancel()}}move(jx,jy){const jz=document[pj];if(!jz)return;let jA=null;switch(jz[lm]){case"music":if(jx){jz[l1]=Math.max(0,Math.min(99,+jz[l1]+jx*10));this[mP]({target:jz})}else if(jy<0)jA="resume";else if(jy>0)jA="sound";break;case"sound":if(jx){jz[l1]=Math.max(0,Math.min(99,+jz[l1]+jx*10));this[mQ]({target:jz})}else if(jy<0)jA="music";else if(jy>0)jA="lang";break;case"lang":if(jx)this.moveLang(jx);else if(jy<0)jA="sound";else if(jy>0)jA="resume";break;case"input":if(jx<0)jA="quit";else if(jx>0)jA="resume";else if(jy<0)jA="lang";else if(jy>0)jA="music";break;case"resume":if(jx<0)jA="input";else if(jx>0)jA="quit";else if(jy<0)jA="lang";else if(jy>0)jA="music";break;case"quit":if(jx<0)jA="resume";else if(jx>0)jA="input";else if(jy<0)jA="lang";else if(jy>0)jA="music";break;default:jA=document[pw]("input[name='resume']");break;}if(typeof jA==="string"){jA=document[pw]("*[name='"+jA+"']")}if(jA){jA[lK]()}}moveLang(jB){const jC=document[pw]("select[name='lang']");let jD=jC[py]+jB;if(jD<0)jD=jC[mS][mi]-1;else if(jD>=jC[mS][mi])jD=0;jC[py]=jD;this[mo]({target:jC})}activate(){const jE=document[pj];jE?.click?.();if(jE?.[lm]==="input"){this[mW]=65535}}cancel(){this[lu]()}spawn(jF,jG,...jH){const jI=document[pm](jG);for(const arg of jH)if(arg&&typeof arg==="object"){if(arg instanceof Array){for(const cls of arg)jI.classList.add(cls)}else if(arg instanceof HTMLElement){jI[nV](arg)}else{for(const k of Object[lg](arg))if(k[nN]("on-")){jI[pU](k[nt](3),arg[k])}else{jI.setAttribute(k,arg[k])}}}else{jI.innerText=arg}if(jF)jF[nV](jI);return jI}onMusic(jJ){const jK=Math.max(0,Math.min(99,+jJ[my][l1]||0));this.rt[pp](2,jK)}onSound(jL){const jM=Math.max(0,Math.min(99,+jL[my][l1]||0));this.rt[pp](3,jM)}onLang(jN){this.rt[pp](1,+jN[my][l1])}onInput(jO){this.rt[lN][p3]()}onResume(jP){this[lu]()}onQuit(jQ){this.rt[pq](0)}}class jR{constructor(jS){this.rom=new E(jS);this[lh]=174;this[mf]=[];this[lb]=new ae(this);this[l2]=new bB(this);this[lC]=new c$(this);this[lN]=new hs(this);this[l$]=null;this[lL]=null;this[pe]=null;this[nO]=!1;this[nH]=!1;this[nJ]=0;this[n2]=(this.rom[mK]("title")||"eggGame")+".";switch(this.rom[mK]("menu")){case"none":this[pI]=0;break;case"default":this[pI]=1;break;default:this[pI]=1;}const jT=this.rom[mK]("persistKey");if(jT)this[n2]+=jT+".";this[pH]=0;this[pt]=.012;this[pW]=.016666;this[ps]=.02;this[lK]=!0;this[pr]=null}start(){this[nO]=!1;this[nH]=!1;this[nJ]=0;this.selectLanguage();this.populateDocument();this.populateStorePerParams();if(!this[pr]){this[pr]=e=>this.onFocus(e);window[pU]("focus",this[pr]);window[pU]("blur",this[pr])}this.loadWasmAndImages()[lw](()=>{this[l2][lV]();this[lC][lV]();this[lN][lV]();const jU=this[lb].egg_client_init();this[nH]=!0;if(jU<0)throw"Error "+jU+" from game's initializer.";this[pH]=Date.now()/1000;this[pe]=requestAnimationFrame(()=>this[mA]())})[lE](e=>{this.reportError(e);this[lu]()})}stop(){if(this[nH]&&this[lb][pP]){this[lb][pP](this[nJ]);this[nH]=!1}if(this[pr]){window[p4]("focus",this[pr]);window[p4]("blur",this[pr]);this[pr]=null}this[l2][lu]();this[lC][lu]();this[lN][lu]();if(this[l$]){this[l$][lu]();this[l$]=null}if(this[lL]){this[lL][lu]();this[lL]=null}this[nO]=!0;if(this[pe]){cancelAnimationFrame(this[pe]);this[pe]=null}window.parent?.[n1]?.({event:"eggGameTerminated"})}reportError(jV){console[lH](jV);this[lu]();alert(jV?.[mN]||jV)}onFocus(jW){if(jW[ly]==="focus"){if(!this[lK]){this[lK]=!0;if(!this[nO]&&!this[pe]){this[pe]=requestAnimationFrame(()=>this[mA]())}this[lC][mt]()}}else if(jW[ly]==="blur"){if(this[lK]){this[lK]=!1;this[lC].pause()}}}update(){this[pe]=null;if(this[nO])return this[lu]();if(!this[lK])return;this[lC][mA]();this[lN][mA]();if(this[nO])return this[lu]();const jX=Date.now()/1000;let jY=jX-this[pH];if(jY<0){jY=this[pW]}else if(jY<this[pt]){this[pe]=requestAnimationFrame(()=>this[mA]());return}else if(jY>this[ps]){jY=this[ps]}this[pH]=jX;if(this[lL]){this[lL][mA](jY)}else if(this[l$]){this[l$][mA](jY)}else{this[lb].egg_client_update(jY)}if(this[nO])return this[lu]();this[l2].beginFrame();if(!this[lL])this[lb].egg_client_render();if(this[lL])this[lL].render();this[l2].endFrame();this[pe]=requestAnimationFrame(()=>this[mA]())}selectLanguage(){const jZ=Array.from(new Set((navigator.languages?.map(l=>this[m7](l))||[]).concat(this[m7](navigator.language))[mb](v=>v)));const j_=this.rom[mK]("lang")[lU](',').map(v=>this[m7](v[lx]()));for(const lang of jZ)if(j_[m5](lang)){this[lh]=lang;return}if(j_[mi]>0){this[lh]=j_[0];return}if(jZ[mi]>0){this[lh]=jZ[0];return}}langEval(j$){if(!j$)return 0;if(j$[mi]<2)return 0;let j0=j$[nF](0);if(j0>=65&&j0<=90)j0+=32;j0-=96;let j1=j$[nF](1);if(j1>=65&&j1<=90)j1+=32;j1-=96;if(j0<1||j0>26||j1<1||j1>26)return 0;return j0<<5|j1}langRepr(j2){const j3=j2>>5;const j4=j2&31;if(j3>=1&&j3<=26&&j4>=1&&j4<=26){return String[pc](96+j3)+String[pc](96+j4)}return"??"}populateDocument(){document[lY]=this.rom[mK]("title",this[lh]);document[k7].innerHTML='<div id="fbouter"><canvas id="eggfb"></canvas></div>'}languageChanged(){document[lY]=this.rom[mK]("title",this[lh]);this[lb][pZ](1,this[lh])}populateStorePerParams(){let j5=location?.search?.[nt]?.(1);if(!j5)return;j5=j5[lU]('&').reduce((j6,j7)=>{const j8=j7[lU]('=');const j9=decodeURIComponent(j8[0]);const kb=decodeURIComponent(j8[1]||"");j6[j9]=kb;return j6},{});const kd=this.rom[mK]("params")[lU](",");for(const key of kd){const ke=j5[key];if(typeof ke!=="string")continue;const kf=this[n2]+key;if(ke)localStorage[mX](kf,ke);else localStorage[nM](kf)}}loadWasmAndImages(){const kg=[];let kh=!1;for(const res of this.rom[ls])if(res.tid===g&&res.rid===1){kg[lq](this[lb].load(res.v));kh=!0}else if(res.tid===o){kg[lq](this.loadImage(res.rid,res.v))}if(!kh)return Promise[mq]("code:1 not found");return Promise.all(kg)}loadImage(ki,kj){return new Promise((kk,kl)=>{const km=new Blob([kj]);const kn=URL[pO](km);const ko=new Image();ko.onload=()=>{this[mf][ki]=ko;URL[pR](kn);kk()};ko.onerror=e=>{URL[pR](kn);kl(e)};ko.src=kn})}toggleUmenu(){if(this[l$]){this[l$][lu]();this[l$]=null}else if(this[pI]===1){this[l$]=new jk(this);this[l$][lV]()}}egg_terminate(kq){this[nO]=!0;this[nJ]=kq}egg_log(kr){const ks=this[lb][nl](kr,1024);console.log("GAME: "+ks)}egg_time_real(){return Date.now()/1000}egg_time_local(kt,ku){if(ku<1)return;kt>>=2;const kv=this[lb][m4]();if(kt<0||kt>kv[mi]-ku)return;const kw=new Date();kv[kt++]=kw.getFullYear();if(ku<2)return;kv[kt++]=1+kw.getMonth();if(ku<3)return;kv[kt++]=kw.getDate();if(ku<4)return;kv[kt++]=kw.getHours();if(ku<5)return;kv[kt++]=kw.getMinutes();if(ku<6)return;kv[kt++]=kw.getSeconds();if(ku<7)return;kv[kt]=kw.getMilliseconds()}egg_prefs_get(kx){switch(kx){case 1:return this[lh];case 2:return this[lC][nm];case 3:return this[lC][nq];}return 0}egg_prefs_set(ky,kz){switch(ky){case 1:{if(kz===this[lh])return 0;if(!this.validLang(kz))return-1;this[lh]=kz;this.languageChanged()}return 0;case 2:{const kA=this[lC][nm];this[lC].setMusicTrim(kz);if(this[lC][nm]!==kA)this[lb][pZ](2,this[lC][nm])}return 0;case 3:{const kB=this[lC][nq];this[lC].setSoundTrim(kz);if(this[lC][nq]!==kB)this[lb][pZ](3,this[lC][nq])}return 0;}return-1}validLang(kC){if(typeof kC!=="number"||kC&-1024)return!1;const kD=kC>>5;const kE=kC&31;if(kD<1||kD>26||kE<1||kE>26)return!1;return!0}egg_rom_get(kF,kG){const kH=Math.min(kG,this.rom[mu][mi]);const kI=this[lb][nk](kF,kH);if(kH<this.rom[mu][mi])kI.set(new Uint8Array(this.rom[mu][l6],this.rom[mu][nE],kH));else kI.set(this.rom[mu]);return this.rom[mu][mi]}egg_rom_get_res(kJ,kK,kL,kM){const kN=this.rom[md](kL,kM);if(!kN)return 0;const kO=Math.min(a,kN[mi]);const kP=this[lb][nk](p,kO);if(kO<kN[mi])kP.set(new Uint8Array(kN[l6],kN[nE],kO));else kP.set(kN);return kN[mi]}egg_store_get(kQ,kR,kS,kT){const kU=this[n2]+this[lb][nl](kS,kT);const kV=localStorage[mJ](kU)||"";return this[lb][np](kQ,kR,kV)}egg_store_set(kW,kX,kY,kZ){const k_=this[n2]+this[lb][nl](kW,kX);const k$=this[lb][nl](kY,kZ);if(k$)localStorage[mX](k_,k$);else localStorage[nM](k_);return 0}egg_store_key_by_index(k0,k1,k2){if(k2<0)return 0;for(let k3=0;;k3++){const k4=localStorage.key(k3);if(!k4[nN](this[n2]))continue;if(!k2--)return this[lb][np](k0,k1,k4)}return 0}}addEventListener("load",()=>{fetch("./game.bin")[lw](rsp=>{if(!rsp.ok)throw rsp;return rsp[nW]()})[lw](serial=>{new jR(new Uint8Array(serial))[lV]()})[lE](e=>{console[lH](e?.[mN]||e?.[nd]()||e)})},{once:!0});</script></head><body></body></html>
